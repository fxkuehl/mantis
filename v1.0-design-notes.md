# Mantis v1.0 Design Notes

New construction using a largely 3D-printed case, FR4 switch plate and gasket
mounting. May use laser cut plates for bottom and top decks of the case for a
version with wooden look and maybe different sound profile. But a fully
3D-printed design is probably easier to build (fewer parts, can be ordered
from fewer sources).

## Switches and Sockets

I'll stick with Choc v1 switches for now. Gateron LP switches may be an
interesting alternative for cheaper versions in the future. Planning to use
hotswap sockets. The main reason v0.3 did not use hotswap was because of the
sound-channels (which did not work out as intended for acoustics).

## Switch Plates and PCBs

Choc v1 switches work best with 1.2mm switch plates. The easiest way to make
that is as a 1.2mm FR4 plate that can be ordered together with the PCBs. The
plates themselves will be mostly invisible. To save height in the case while
allowing enough room for the gasket-mounted switch assembly to move, also use
a 1.2mm PCB.

## Gaskets

Poron gaskets are 2mm minimum. How much should gaskets be compressed at rest?
I don't want the top gasket to expand beyond 2mm. What's the max travel at
reasonable typing force? Guess:

- Use 2mm gaskets, 1.2mm plates
- Pre-compress each gasket by half the plate thickness (0.6mm) to 1.4mm
- Total height of the gasket-plate-gasket sandwitch is 4mm
- Max downward travel is 0.6mm with the top-gasket fully expanded
- Bottom gasket compressed to 0.8mm at max travel, 40% of original height
- Thicker (stiffer) plate leads to more compression, stiffer gasket

https://www.amazon.ca/Mechanical-Keyboard-Gasket-Cotton-Positioning/dp/B0C65TYR98

## Case Construction

Sketch of layered construction:

                           4.0mm to top of high-profile key caps
                           6.0mm to top of low-profile key caps
          ----------------
           3mm top deck    3.6mm to bottom of key caps
          ----------------
          ---------- 1.4mm gasket
           4mm mez2  1.2mm top switch plate ========================
          ---------- 1.4mm gasket                        1mm gap or foam to PCB
          ----------------                  ============ 1.2mm PCB
           3mm mez1                          ===   ===   1.8mm components
          ----------------                               0.4mm gap/travel
    ----------------
     3mm mid deck    3.6mm to bottom of key caps
    ----------------
    ---------- 1.4mm gasket
     4mm rim2  1.2mm bottom switch plate    ========================
    ---------- 1.4mm gasket                              1mm gap or foam to PCB
    ----------------                        ============ 1.2mm PCB
     3mm rim1                                ===   ===   1.8mm components
    ----------------                                     0.4mm gap/travel
    -----------------------------------------------------------------------
     3mm bottom
    -----------------------------------------------------------------------
     1mm bumpers (thin or recessed)

    24mm total case height without key caps (23mm without bumpers)
    30.6mm total with low-profile key caps
    34.6mm total with high-profile key caps

### Height comparisons with v0.3

Assuming 1.6mm PCB, 3mm plates on v0.3, ignoring feet on v0.3 and v1.0.

|                              |   v0.3 |   v1.0 |   Diff |
|------------------------------|-------:|-------:|-------:|
| Bottom of bottom PCB         |  6.0mm |  5.2mm | -0.8mm |
| Top of bottom switch plate   | 10.6mm |  8.6mm | -2.0mm |
| Bottom of top PCB            | 16.6mm | 15.2mm | -1.4mm |
| Top of top switch plate      | 21.2mm | 18.6mm | -2.6mm |
| Rise from bottom to top keys | 10.6mm | 10.0mm | -0.6mm |
| Bottom case height w/o keys  | 10.6mm | 13.0mm | +2.4mm |
| Total case height w/o keys   | 21.2mm | 23.0mm | +1.8mm |
| Effective tenting angle<br>[atan(rise/37.24)] | 15.9°  | 15°    | -0.9°  |

Including thinner feet, v1.0 should sit about 4.5mm lower than v0.3. A thinner
bottom plate may increase that margin. The effective tenting angle matches the
key tilt almost perfectly. Because it's a high-profile case it looks slightly
bulkier.

## Controller

Use separate controller to make it easier to build a wireless version. Leave
room under controller for battery. Controller can fit between keys on the top
plate like on v0.2, but covered up by top deck. Vertical space avaliable
between bottom PCB and top deck is 11.4mm. It should leave enough room for
easy socketing with 5mm headers and a battery and power switch between
controller and PCB.

## Trackball Sensor

Trackball sensors supported by QMK:

- PMW 3320
- PMW 3360 (supported by VIK modules, seems most common)
- PMW 3389
- PMW 3610 (lower power, laser based, VIK module available)

Design for PMW 3610 to accommodate wireless version.

### Data sheets
https://d3s5r33r268y59.cloudfront.net/datasheets/9604/2017-05-07-18-19-11/PMS0058-PMW3360DM-T2QU-DS-R1.50-26092016._20161202173741.pdf

https://www.epsglobal.com/Media-Library/EPSGlobal/Products/files/pixart/PMW3610DM-SUDU.pdf?ext=.pdf

https://trackballs.eu/media/Nakabayashi/Digio2/PMW3610DM-SUDU.pdf

https://s2.manualzz.com/store/data/043036065_1-6bdc51206032e3e22a1be42afd604cc5.png

## Trackball Mounting

Trackball sensor must be on a separate PCB that does not move while typing.
Otherwise typing may randomly nudge the pointer. Alternatively the trackball
holder would need to be mounted to the bottom switch plate, so it is
effectively also gasket-mounted. This would result in the trackball sitting
about 2.2mm higher, but keeps the sensor protected inside the case.

The sensor can be recessed into a cut-out in the bottom plate. PMW-3610
extends 1.65mm below the PCB. Lens guide-posts may extend slightly further.
Thickness of sensor+lens to the navigation plane (bottom of trackball) is
7.4mm from the bottom of the sensor PCB. Assmuing the PCB is flush with the
bottom plate, with a cutout or recess for the sensor in the bottom blate,
a 30mm trackball would reach 40.4mm from the bottom of the keyboard case. The
equator would be at 25.4mm, about 2.5mm above the case height.

A 25.4mm trackball would reach 35.8mm from the bottom of the keyboard, about
2mm taller than the top of the tall key caps. The equator would be at 23.1mm,
very close to the case height. This seems ideal. With the trackball mounted to
the bottom switch plate and PCB, it would sit 2.2mm higher: equator at 25.3mm,
apex at 38mm. A smaller trackball also makes the mouse buttons easier to
design into the top deck. One-inch marbles, wood balls or ball bearings are
widely available.

### Low profile 34mm Trackball

The idea is to mount a 34mm trackball with an opening in the bottom plate to
achieve the lowest possible profile. To make more of the trackball surface
accessible, move the trackball forward, eliminating the front corner of the
keyboard top case.

The low trackball prevents mounting the sensor on the main PCB below the
trackball. There are two option for mounting the sensor.

#### Sensor at an angle

With a PMW-3610 the optical center is closer to one end. This would allow
mounting the sensor at a 68° angle from horizontal without interfering with
the bottom plate (assuming a sufficiently compact sensor PCB). This makes the
trackball most usable for the thumb, which touches the ball near the front of
the keyboard and can control two axes of movement that are both picked up by
the sensor. It can be used left-handed or right-handed by flipping the vertical
axis.

A 3mm raised trackball without bottom plate hole results in a 60° angle. The
tilted sensor PCB can be about 19mm tall and needs about 18mm of space next to
the trackball.

However, this sensor placement makes the trackball less usable with the fingers
since it is less sensitive to lateral movements of the fingers across the
surface. At the 60° sensor angle, lateral movement results in 50% less movement
visible to the sensor.

This mounting style would require one additional PCB for the sensor and an
additional (VIK) cable.

#### Two vertical sensors 90° apart

Using two sensors enables tracking in three axis. This allows arbitrary
configuration of the preferred axes for cursor movement and scrolling. It would
enable using the trackball with fingers while using the thumb for scrolling.

The vertical space available inside the case is about 17mm. This is less than
the width of the PMW-3360 lens. Therefore this option would only work with
PMW-3610. In the correct orientation, the optical center of the sensor is
5.48mm from the top, and 10.72mm from the bottom. The trackball equator is at
15mm from the top of the bottom plate and 2mm from the bottom of the top plate.
Getting the sensors to track the equator of the track ball would require
raising the top plate or adding about 4mm indentations to accommodate the
sensors.

Finding enough horizontal space for the second sensor would be challenging.
PMW-3610 with lens needs 9.05mm from the side of the trackball. This would
barely clear the switch housing of the adjacent thumb key. One would need to
exploit the asymmetry of Choc hotswap sockets to fit the sensor on the left
side of the trackball and leave the switch cut open to that side. Then the
sensor would still interfere with the keycap of the adjacent thumb key.

To track the ball the the right angle, the sensor would need to be as far
forward as possible without being protected by the case. Or the trackball set
back slightly, making it somewhat less thumb-accessible between the two forward
thumb keys.

Another solution that would possibly address both problems is to increase the
distance between left and right hand. That would add more lateral space and
allow the trackball to move further forward, allowing the sensors to be mounted
on diagonal angles.

This mounting style would require two additional PCBs for the sensors,
increase power consumption and possibly complicate the firmware. It would
further require an additional cable and use more pins on the controller.

## Mouse Switches

The two innermost thumb keys are eliminated to make room for the trackball.
But the same matrix positions can be used for mouse switches, which take up
less space.

Mouse switches: [Omron Datasheet](https://omronfs.omron.com/en_US/ecb/products/pdf/en-d2f.pdf)

    Travel:             <1mm
    Pre-travel:         0.5mm
    Resting position:   7.5mm above PCB
    Operating position: 7.0mm above PCB
    Width:              5.7mm
    Length:             12.7mm (1/2")
    Operating Force:    150gf or 75gf

Only have 3.6mm from top PCB to bottom of top deck. Therefore top deck cannot
serve a mouse button. I need to raise it another 4mm-ish. Could be another
plate hovering 1mm above the top deck, which would give it the right height
and enable enough travel to actuate the switch. It would rise above the
equator of the trackball and could also function as a retaining ring. I would
need to leave a gap in the top deck to fit the mouse switch at the front edge
of the case or find a clever position that doesn't intefere with other keys
or the trackball.

Alternatively the mouse switches could be on the bottom PCB. The way the top
deck is suspended between the sides and the back, it should work well as a
compliant mechanism that could actuate mouse buttons underneath. The top PCB
could then have LEDs under the mouse-switch-areas of the top deck.

## Cables to Connect PCBs

If controller+USB is on single bottom key PCB, need one cable to sensor PCB
(VIK?, if on a separate PCB) and one cable to the top PCB.

    Cable to top PCB:          4x4, ground, 5V, LED in/out: 12 pins
    Cable to trackball module: VIK:                         12 pins

## PCB Assembly

Automated PCB-assembly can greatly reduce build time and effort. Also avoids
having to order many small components separately. Some components will still
be hand-soldered.

### Automated Assembly of SMD Components

* LEDs
* Diodes (use dual diodes in one package)
* Hotswap sockets
* Capacitors
* Resistors
* Voltage regulators

### Manual Assembly of Optional and Through-Hole Components

* Headers (optional)
* Controllers
* Trackball sensor
* Mouse switches
* Battery terminals
* Power switch

# Next Steps

* Design PCBs, switch plates and case outlines with Ergogen
* Design 3D-printed case components (using case outlines) with OpenSCAD
* Route PCBs
* Finalize component choices, mounting HW, etc.
* Order parts
* Create firmware (QMK for wired, ZMK for wireless)
* Build
* Create updated build-guide

## Open Details

* Types of cables and connectors
* Size and shape of cut-outs for LEDs to allow automated assembly
* Exact placement of trackball sensor relative to trackball holder
* Level-shifting circuit for LEDs
* Bill of Materials